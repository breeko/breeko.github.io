<!DOCTYPE html>
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Lisp, Floating Points and Muller&#39;s Recurrence &middot; Branko Blagojevic</title>
        <meta name="description" content="Floating point number representations are annoying to work with. Lisp and by extension Clojure deal with them by using fractions instead.
Floating point representations can lead to some strange results. Lisp and Clojure have fraction representations built in, helping avoid many of the problems with floats.
I came across this article about why the IRS has had trouble to break away from Cobol. The article argues that a big reason is due to Cobol’s native support of fixed point as opposed to floating point.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.54.0" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Lisp, Floating Points and Muller&#39;s Recurrence">
<meta property="og:description" content="Floating point number representations are annoying to work with. Lisp and by extension Clojure deal with them by using fractions instead.
Floating point representations can lead to some strange results. Lisp and Clojure have fraction representations built in, helping avoid many of the problems with floats.
I came across this article about why the IRS has had trouble to break away from Cobol. The article argues that a big reason is due to Cobol’s native support of fixed point as opposed to floating point.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://breeko.github.io/post/2018-07-30_lisp-floating-points-and-muller-s-recurrence/">
        <link rel="stylesheet" href="https://breeko.github.io/dist/styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="ML-Everything" href="https://breeko.github.io/">ML-Everything</a>
                            </h1>
                        
                        <a class="button-square" href="https://breeko.github.io/index.xml"><i class="fa fa-rss"></i></a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/breeko">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Email" title="Email" href="mailto:branko.blagojevic@gmail.com">
                                <i class="fa fa-envelope"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="Tags" href="/tags">Tags</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Lisp, Floating Points and Muller&#39;s Recurrence</h1>
    
    <p class="post-date post-line">
        <span>Published <time datetime="2018-07-30" itemprop="datePublished">Mon, Jul 30, 2018</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="#" itemprop="url" rel="author">Branko Blagojevic</a>
            </span>
        </span>
    </p>
    
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    

<p>Floating point number representations are annoying to work with. Lisp and by extension Clojure deal with them by using fractions instead.</p>

<p>Floating point representations can lead to some strange results. Lisp and Clojure have fraction representations built in, helping avoid many of the problems with floats.</p>

<p>I came across <a href="https://medium.com/@bellmar/is-cobol-holding-you-hostage-with-math-5498c0eb428b">this article</a> about why the IRS has had trouble to break away from Cobol. The article argues that a big reason is due to Cobol’s native support of fixed point as opposed to floating point. Below is a quick recap of the article and the problem with floating points.</p>

<h4 id="the-problem-with-floating-point-representation">The problem with floating point representation</h4>

<p>The nature of floating point representations results in some unexpected values. For instance, in python if you try to add 0.1 and 0.2 you get the result below.</p>

<pre><code>&gt;&gt;&gt; 0.1 + 0.2  
0.30000000000000004
</code></pre>

<p>The dangerous thing about this is that it crops up in unexpected places and during recursion can build up to drastically deviate from the expected result. Muller’s Recurrence is a prime example.</p>

<p><img src="/post/resources/img/1*2v87YedN_QU2DBLZtI8fTQ.png" alt="" /></p>

<p>Example of Muller’s Recurrence</p>

<p>If you were to compare the results as i goes from 0 to 19 using floating vs fixed points, you would get the results below.</p>

<pre><code>i  | floating pt    | fixed pt  
-- | -------------- | ---------------------------  
0  | 4              | 4  
1  | 4.25           | 4.25  
2  | 4.47058823529  | 4.4705882352941176470588235  
3  | 4.64473684211  | 4.6447368421052631578947362  
4  | 4.77053824363  | 4.7705382436260623229461618  
5  | 4.85570071257  | 4.8557007125890736342039857  
6  | 4.91084749866  | 4.9108474990827932004342938  
7  | 4.94553739553  | 4.9455374041239167246519529  
8  | 4.96696240804  | 4.9669625817627005962571288  
9  | 4.98004220429  | 4.9800457013556311118526582  
10 | 4.9879092328   | 4.9879794484783912679439415  
11 | 4.99136264131  | 4.9927702880620482067468253  
12 | 4.96745509555  | 4.9956558915062356478184985  
13 | 4.42969049831  | 4.9973912683733697540253088  
14 | -7.81723657846 | 4.9984339437852482376781601  
15 | 168.939167671  | 4.9990600687785413938424188  
16 | 102.039963152  | 4.9994358732880376990501184  
17 | 100.099947516  | 4.9996602467866575821700634  
18 | 100.004992041  | 4.9997713526716167817979714  
19 | 100.000249579  | 4.9993671517118171375788238
</code></pre>

<p>For more discussion, visit the <a href="https://medium.com/@bellmar/is-cobol-holding-you-hostage-with-math-5498c0eb428b">original article</a>. It goes more in depth and I recommend reading it.</p>

<h4 id="muller-s-recurrence-in-clojure">Muller’s Recurrence in Clojure</h4>

<p>I’ve been dabbling in lisp and Clojure over the last few weeks (Clojure is a dialect of lisp). One of the cool things about lisp is that it handles fractions natively. For example, when doing integer division the results are represented as fractions. 1 divided by 10 is the fraction <sup>1</sup>&frasl;<sub>10</sub>. And operations on fractions work as expected.</p>

<pre><code class="language-clojure">(/ 1 10) =&gt; 1/10  
(+ 1/10 2/10) =&gt; 3/10
</code></pre>

<p>Of course you can still do floating point calculations.</p>

<pre><code class="language-clojure">(/ 1 10.0)  =&gt; 0.1  
(+ 0.1 0.2) =&gt; 0.30000000000000004
</code></pre>

<p>As a quick side-note, lisp has a syntax different from most modern programming languages.</p>

<p>Most languages:</p>

<pre><code>function(arg1, arg2, ..., argn)  
</code></pre>

<p>e.g. sum(1, 2)</p>

<p>Lisp</p>

<pre><code>(function-name arg1 arg2 ... argn)  
</code></pre>

<p>e.g. (sum 1 2)</p>

<p>In general, lisp handles numbers very well and can do some impressive calculations. Below is an example of 53 ^ 53 in Common Lisp (example stolen from the great book <a href="https://www.amazon.com/Land-Lisp-Learn-Program-Game/dp/1593272812/ref=sr_1_1">Land of Lisp</a>).</p>

<pre><code>&gt; (expt 53 53)  
24356848165022712132477606520104725518533453128685640844505130879576720609150223301256150373
</code></pre>

<h4 id="muller-s-recurrence-in-clojure-1">Muller’s Recurrence in Clojure</h4>

<p>How would the previous example of Muller’s Recurrence look in Clojure?</p>

<pre><code class="language-clojure">(defn rec  
  [y,z]  
  (- 108  
     (/  
      (- 815   
         (/ 1500 z))  
      y)  
))
</code></pre>

<p>The above defines a function rec, which takes two parameters, y and z. Again, here is the formula we used as an example of Muller’s Recurrence.</p>

<p><img src="/post/resources/img/1*2v87YedN_QU2DBLZtI8fTQ.png" alt="" /></p>

<p>Muller’s Recurrence</p>

<p>To calculate xi recursively, we can use the formula below, which will print out our results as they get processed.</p>

<pre><code class="language-clojure">(defn recn  
  [n y z]  
  (do (println n y z)) (if (&lt;= n 0) z (recn (- n 1) (rec y z) y)))
</code></pre>

<p>Since Clojure works with fractions, using fractions as inputs just treats everything as a fraction, avoiding the problem with floating points.</p>

<pre><code class="language-clojure">=&gt; (recn 20 17/4 4)  
20 17/4 4  
19 76/17 17/4  
18 353/76 76/17  
17 1684/353 353/76  
16 8177/1684 1684/353  
15 40156/8177 8177/1684  
14 198593/40156 40156/8177  
13 986404/198593 198593/40156  
12 4912337/986404 986404/198593  
11 24502636/4912337 4912337/986404  
10 122336033/24502636 24502636/4912337  
9 611148724/122336033 122336033/24502636  
8 3054149297/611148724 611148724/122336033  
7 15265963516/3054149297 3054149297/611148724  
6 76315468673/15265963516 15265963516/3054149297  
5 381534296644/76315468673 76315468673/15265963516  
4 1907542343057/381534296644 381534296644/76315468673  
3 9537324294796/1907542343057 1907542343057/381534296644  
2 47685459212513/9537324294796 9537324294796/1907542343057  
1 238423809278164/47685459212513 47685459212513/9537324294796  
0 1192108586037617/238423809278164 238423809278164/47685459212513  
238423809278164/47685459212513
</code></pre>

<p>Note this example counts down from 20 while the original example counts up to 20.</p>

<p>If we want to convert that final value to a float, we can do so:</p>

<pre><code class="language-clojure">(float **238423809278164/47685459212513**)  
4.9999268795046
</code></pre>

<p>But of course, if you start out with floats, you’ll have the same problem:</p>

<pre><code class="language-clojure">=&gt; (recn 20 4.25 4)  
20 4.25 4  
19 4.470588235294116 4.25  
18 4.6447368421052175 4.470588235294116  
17 4.770538243625083 4.6447368421052175  
16 4.855700712568563 4.770538243625083  
15 4.91084749866063 4.855700712568563  
14 4.945537395530508 4.91084749866063  
13 4.966962408040999 4.945537395530508  
12 4.980042204293014 4.966962408040999  
11 4.987909232795786 4.980042204293014  
10 4.991362641314552 4.987909232795786  
9 4.967455095552268 4.991362641314552  
8 4.42969049830883 4.967455095552268  
7 -7.817236578459315 4.42969049830883  
6 168.93916767106458 -7.817236578459315  
5 102.03996315205927 168.93916767106458  
4 100.0999475162497 102.03996315205927  
3 100.00499204097244 100.0999475162497  
2 100.0002495792373 100.00499204097244  
1 100.00001247862016 100.0002495792373  
0 100.00000062392161 100.00001247862016  
100.00001247862016
</code></pre>

<p>Lisp’s native handling of fractions is a nice feature that can help you avoid some problems associated with floating point numbers.</p>

<p>By Branko Blagojevic July 30, 2018</p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/lisp/">lisp</a>, 
            
                <a href="/tags/clojure/">clojure</a>
            
        </p>
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=Lisp%2c%20Floating%20Points%20and%20Muller%27s%20Recurrence&url=https%3a%2f%2fbreeko.github.io%2fpost%2f2018-07-30_lisp-floating-points-and-muller-s-recurrence%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fbreeko.github.io%2fpost%2f2018-07-30_lisp-floating-points-and-muller-s-recurrence%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        

        
        
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="ML-Everything" href="https://breeko.github.io/">ML-Everything</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2018 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="https://breeko.github.io/js/jquery-1.11.3.min.js"></script>
        <script src="https://breeko.github.io/js/jquery.fitvids.js"></script>
        
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        
        
        <script src="https://breeko.github.io/js/scripts.js"></script>
    </body>
</html>

